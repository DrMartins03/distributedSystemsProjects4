<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Replica State Dashboard</title>

<style>
    body {
        margin: 0;
        background: #eef0f5;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    header {
        background: #2d6cdf;
        color: white;
        padding: 24px;
        font-size: 26px;
        text-align: center;
        font-weight: bold;
        letter-spacing: 1px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.25);
    }

    .columns {
        display: flex;
        width: 100%;
        height: 100%;
        overflow-y: auto;
    }

    .layer {
        width: 33.3333%;
        padding: 20px;
        box-sizing: border-box;
        border-right: 1px solid #ccc;
    }

    .layer:last-child {
        border-right: none;
    }

    .layer-title {
        font-size: 22px;
        margin-bottom: 18px;
        font-weight: bold;
        color: #1f2937;
        text-align: center;
        padding-bottom: 8px;
        border-bottom: 2px solid #d1d5db;
    }

    .node-card {
        background: #ffffff;
        border-radius: 10px;
        border: 1px solid #d1d5db;
        padding: 14px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        transition: transform 0.15s;
    }

    .node-card:hover {
        transform: scale(1.02);
    }

    .node-title {
        font-size: 18px;
        font-weight: bold;
        text-align: center;
        color: #374151;
        margin-bottom: 10px;
    }

    .node-content {
        background: #f9fafb;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        padding: 10px;
        min-height: 70px;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 14px;
    }
</style>

<script>
    function formatJSON(data) {
        try {
            const obj = JSON.parse(data);
            return Object.entries(obj)
                .map(([k, v]) => `${k}: ${v}`)
                .join("\n");
        } catch {
            return "Invalid JSON";
        }
    }

    const layers = {
        A: [
            { id: "A1", port: 5100 },
            { id: "A2", port: 5101 },
            { id: "A3", port: 5102 }
        ],
        B: [
            { id: "B1", port: 6100 },
            { id: "B2", port: 6101 }
        ],
        C: [
            { id: "C1", port: 7100 },
            { id: "C2", port: 7101 }
        ]
    };

    window.onload = () => {
        Object.values(layers).flat().forEach(node => {
            const ws = new WebSocket(`ws://localhost:${node.port}`);

            ws.onmessage = evt => {
                document.getElementById(`data_${node.id}`).textContent =
                    formatJSON(evt.data);
            };

            ws.onerror = () => {
                document.getElementById(`data_${node.id}`).textContent =
                    "Connection error";
            };
        });
    };
</script>
</head>

<body>
<header>Distributed Replica State Dashboard</header>

<div class="columns">

    <!-- CORE LAYER -->
    <div class="layer">
        <div class="layer-title">Core Layer (A)</div>

        <div class="node-card">
            <div class="node-title">A1</div>
            <div class="node-content" id="data_A1">Waiting…</div>
        </div>

        <div class="node-card">
            <div class="node-title">A2</div>
            <div class="node-content" id="data_A2">Waiting…</div>
        </div>

        <div class="node-card">
            <div class="node-title">A3</div>
            <div class="node-content" id="data_A3">Waiting…</div>
        </div>
    </div>

    <!-- FIRST LAYER -->
    <div class="layer">
        <div class="layer-title">First Layer (B)</div>

        <div class="node-card">
            <div class="node-title">B1</div>
            <div class="node-content" id="data_B1">Waiting…</div>
        </div>

        <div class="node-card">
            <div class="node-title">B2</div>
            <div class="node-content" id="data_B2">Waiting…</div>
        </div>
    </div>

    <!-- SECOND LAYER -->
    <div class="layer">
        <div class="layer-title">Second Layer (C)</div>

        <div class="node-card">
            <div class="node-title">C1</div>
            <div class="node-content" id="data_C1">Waiting…</div>
        </div>

        <div class="node-card">
            <div class="node-title">C2</div>
            <div class="node-content" id="data_C2">Waiting…</div>
        </div>
    </div>

</div>

</body>
</html>
